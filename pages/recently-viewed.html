<!DOCTYPE html>
<html>
<head>
    <title>Recently Viewed Demo</title>
    <link rel="stylesheet" href="../files/bootstrap.min.css">
    <style>
        /* Modern color palette and spacing */
        body {
            background: #f8f9fa;
        }
        
        /* Card headers - solid dark colors */
        .section-header {
            background: #2d3748;
            border: none;
            padding: 1rem 1.25rem;
        }
        
        /* Main content cards */
        .content-card {
            border: none;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            transition: box-shadow 0.3s ease;
        }
        
        .content-card:hover {
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.12);
        }
        
        /* Product cards - uniform styling */
        #available-items .card,
        #target-recs .card {
            min-width: 150px;
            max-width: 150px;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            transition: all 0.3s ease;
            background: white;
        }
        
        #available-items .card:hover,
        #target-recs .card:hover {
            transform: translateY(-4px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.12);
        }
        
        #available-items .card-img-top,
        #target-recs .card-img-top {
            height: 120px;
            object-fit: cover;
            border-radius: 8px 8px 0 0;
        }
        
        #available-items .card-body,
        #target-recs .card-body {
            padding: 0.75rem;
        }
        
        #available-items h4, #available-items h5, #available-items h6,
        #target-recs h4, #target-recs h5, #target-recs h6 {
            font-size: 0.875rem;
            margin-bottom: 0.5rem;
            color: #2d3748;
            font-weight: 600;
        }
        
        #available-items p,
        #target-recs p {
            font-size: 0.875rem;
            margin-bottom: 0.75rem;
        }
        
        /* Buttons - modern styling with solid colors */
        .btn-primary {
            background: #4a5568;
            border: none;
            font-weight: 500;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            transition: all 0.3s ease;
            color: white;
        }
        
        .btn-primary:hover {
            background: #2d3748;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(45, 55, 72, 0.4);
        }
        
        .btn-light {
            background: white;
            border: none;
            color: #2d3748;
            font-weight: 600;
        }
        
        .btn-light:hover {
            background: #f7fafc;
            color: #2d3748;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        }
        
        .btn-outline-secondary {
            border-color: #cbd5e0;
            color: #4a5568;
            border-radius: 8px;
            transition: all 0.3s ease;
        }
        
        .btn-outline-secondary:hover {
            background: #4a5568;
            border-color: #4a5568;
            color: white;
        }
    </style>
    <script>
        // Adobe Target configuration
        window.targetGlobalSettings = {
            clientCode: 'bullseye',
            serverDomain: 'bullseye.tt.omtrdc.net',
            timeout: 3000
        };

        // Track item view when button is clicked
        function viewItem(itemId, itemName, categoryId, value, imageUrl) {
            if (typeof adobe !== 'undefined' && adobe.target) {
                adobe.target.trackEvent({
                    mbox: 'item-view-mbox',
                    params: {
                        'entity.id': itemId,
                        'entity.name': itemName,
                        'entity.categoryId': categoryId,
                        'entity.value': value,
                        'entity.pageUrl': window.location.href,
                        'entity.thumbnailUrl': imageUrl,
                        'entity.inventory': '100'
                    },
                    success: function() {
                        refreshRecommendations();
                    }
                });
            }
        }

        // Refresh Target recommendations
        function refreshRecommendations() {
            const container = document.getElementById('target-recs');
            container.style.opacity = '0.3';
            container.style.transition = 'opacity 0.3s ease-out';
            
            if (typeof adobe !== 'undefined' && adobe.target) {
                adobe.target.getOffer({
                    mbox: 'r3demo-recently-viewed-recs',
                    selector: '#target-recs',
                    success: function(offer) {
                        adobe.target.applyOffer({ 
                            mbox: 'r3demo-recently-viewed-recs',
                            selector: '#target-recs',
                            offer: offer 
                        });
                        setTimeout(function() {
                            container.style.transition = 'opacity 2s ease-in';
                            container.style.opacity = '1';
                        }, 100);
                    },
                    error: function() {
                        container.style.transition = 'opacity 2s ease-in';
                        container.style.opacity = '1';
                    }
                });
            } else {
                container.style.transition = 'opacity 2s ease-in';
                container.style.opacity = '1';
            }
        }

        // Initialize
        window.addEventListener('DOMContentLoaded', function() {
            // Display current user agent
            const ua = navigator.userAgent;
            const currentUAElement = document.getElementById('currentUA');
            currentUAElement.textContent = ua;
            
            // Highlight if bot detected
            if (ua.toLowerCase().includes('bot') || ua.toLowerCase().includes('crawler')) {
                currentUAElement.style.background = '#d4edda';
                currentUAElement.style.color = '#155724';
                currentUAElement.style.fontWeight = '600';
            }
            
            setTimeout(refreshRecommendations, 1000);
        });
    </script>
    <!-- Adobe Target at.js library -->
    <script src="../scripts/at.js"></script>
</head>
<body>
    <div class="container py-5">
        <div class="text-center mb-5">
            <h1 class="display-5 fw-bold" style="color: #2d3748;">
                Recently Viewed Demo
            </h1>
        </div>
        
        <div class="card mb-4 content-card">
            <div class="card-header section-header text-white">
                <h2 class="h5 mb-0">Available Items</h2>
            </div>
            <div class="card-body">
                <div id="available-items" class="d-flex flex-wrap" style="gap: 15px;">
                    <div class="card text-center">
                        <img src="../files/images/laptop.jpg" class="card-img-top" alt="Laptop Computer">
                        <div class="card-body">
                            <h6 class="card-title">Laptop Computer</h6>
                            <p class="card-text text-primary fw-bold">$999.99</p>
                            <button class="btn btn-primary btn-sm w-100" onclick="viewItem('r3demo-001', 'Laptop Computer', 'r3demo-electronics', '999.99', '../files/images/laptop.jpg')">
                                View
                            </button>
                        </div>
                    </div>
                    <div class="card text-center">
                        <img src="../files/images/mouse.jpg" class="card-img-top" alt="Wireless Mouse">
                        <div class="card-body">
                            <h6 class="card-title">Wireless Mouse</h6>
                            <p class="card-text text-primary fw-bold">$29.99</p>
                            <button class="btn btn-primary btn-sm w-100" onclick="viewItem('r3demo-002', 'Wireless Mouse', 'r3demo-electronics', '29.99', '../files/images/mouse.jpg')">
                                View
                            </button>
                        </div>
                    </div>
                    <div class="card text-center">
                        <img src="../files/images/chair.jpg" class="card-img-top" alt="Office Chair">
                        <div class="card-body">
                            <h6 class="card-title">Office Chair</h6>
                            <p class="card-text text-primary fw-bold">$299.99</p>
                            <button class="btn btn-primary btn-sm w-100" onclick="viewItem('r3demo-003', 'Office Chair', 'r3demo-furniture', '299.99', '../files/images/chair.jpg')">
                                View
                            </button>
                        </div>
                    </div>
                    <div class="card text-center">
                        <img src="../files/images/lamp.jpg" class="card-img-top" alt="Desk Lamp">
                        <div class="card-body">
                            <h6 class="card-title">Desk Lamp</h6>
                            <p class="card-text text-primary fw-bold">$49.99</p>
                            <button class="btn btn-primary btn-sm w-100" onclick="viewItem('r3demo-004', 'Desk Lamp', 'r3demo-furniture', '49.99', '../files/images/lamp.jpg')">
                                View
                            </button>
                        </div>
                    </div>
                    <div class="card text-center">
                        <img src="../files/images/notebook.jpg" class="card-img-top" alt="Notebook Set">
                        <div class="card-body">
                            <h6 class="card-title">Notebook Set</h6>
                            <p class="card-text text-primary fw-bold">$15.99</p>
                            <button class="btn btn-primary btn-sm w-100" onclick="viewItem('r3demo-005', 'Notebook Set', 'r3demo-stationery', '15.99', '../files/images/notebook.jpg')">
                                View
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="card content-card">
            <div class="card-header section-header text-white d-flex justify-content-between align-items-center">
                <h2 class="h5 mb-0">Your Recently Viewed Items</h2>
                <button onclick="refreshRecommendations()" class="btn btn-light btn-sm">
                    üîÑ Refresh
                </button>
            </div>
            <div class="card-body">
                <div id="target-recs">
                    <div class="alert alert-info">
                        <strong>No items viewed yet.</strong> Click on items above to view them.
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Testing Guide Section -->
        <div class="card content-card mt-5">
            <div class="card-header section-header text-white">
                <h2 class="h5 mb-0">üìù Testing Guide</h2>
            </div>
            <div class="card-body">
                <div class="row g-4">
                    <!-- Bot User-Agent -->
                    <div class="col-lg-3 col-md-6">
                        <div class="d-flex align-items-start gap-3">
                            <span style="font-size: 2rem;">ü§ñ</span>
                            <div style="flex: 1;">
                                <h6 class="fw-bold mb-2" style="color: #2d3748;">Test with Bot User-Agent</h6>
                                <p class="mb-3 small text-muted">Open DevTools (F12) ‚Üí Network conditions Tab ‚Üí Change User agent to "Googlebot"</p>
                                <div>
                                    <small class="text-muted d-block mb-2"><strong>Current User-Agent:</strong></small>
                                    <code id="currentUA" style="word-break: break-all; background: #f7fafc; padding: 8px 12px; border-radius: 6px; display: block; font-size: 0.75rem; border: 1px solid #e2e8f0;">Loading...</code>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- New Session -->
                    <div class="col-lg-3 col-md-6">
                        <div class="d-flex align-items-start gap-3">
                            <span style="font-size: 2rem;">üîÑ</span>
                            <div style="flex: 1;">
                                <h6 class="fw-bold mb-2" style="color: #2d3748;">Start a New Session</h6>
                                <p class="mb-2 small text-muted">To test with a fresh visitor profile:</p>
                                <ul class="mb-0 small text-muted" style="padding-left: 1.2rem;">
                                    <li class="mb-2">Open page in <strong>Incognito/Private mode</strong>, OR</li>
                                    <li>Manually delete cookies from Developer Tools<br><span class="text-muted" style="font-size: 0.85em;">(Application ‚Üí Cookies)</span></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Activity Details -->
                    <div class="col-lg-3 col-md-6">
                        <div class="d-flex align-items-start gap-3">
                            <span style="font-size: 2rem;">üéØ</span>
                            <div style="flex: 1;">
                                <h6 class="fw-bold mb-2" style="color: #2d3748;">Activity Details</h6>
                                <p class="mb-2 small text-muted">For debugging and troubleshooting:</p>
                                <div class="small">
                                    <div class="mb-2">
                                        <strong style="color: #4a5568;">Client:</strong>
                                        <code style="background: #f7fafc; padding: 2px 6px; border-radius: 3px; font-size: 0.85em;">bullseye</code>
                                    </div>
                                    <div class="mb-2">
                                        <strong style="color: #4a5568;">Activity ID:</strong>
                                        <code style="background: #f7fafc; padding: 2px 6px; border-radius: 3px; font-size: 0.85em;">1674070</code>
                                    </div>
                                    <div>
                                        <strong style="color: #4a5568;">Rec-Unit ID:</strong>
                                        <code style="background: #f7fafc; padding: 2px 6px; border-radius: 3px; font-size: 0.85em;">387820</code>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Splunk Query -->
                    <div class="col-lg-3 col-md-6">
                        <div class="d-flex align-items-start gap-3">
                            <span style="font-size: 2rem;">üîç</span>
                            <div style="flex: 1;">
                                <h6 class="fw-bold mb-2" style="color: #2d3748;">Splunk Query</h6>
                                <p class="mb-2 small text-muted">Debug requests in Splunk:</p>
                                <code style="word-break: break-all; background: #f7fafc; padding: 8px 12px; border-radius: 6px; display: block; font-size: 0.7rem; border: 1px solid #e2e8f0; line-height: 1.5;">index=target container_name=edge "&lt;session_id&gt;"</code>
                                <small class="text-muted d-block mt-2" style="font-size: 0.75rem;">Replace <code style="background: #fff3cd; padding: 1px 4px; border-radius: 2px;">&lt;session_id&gt;</code> with sessionId from Network tab</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="mt-4 text-center">
            <a href="../index.html" class="btn btn-outline-secondary" style="border-radius: 8px; padding: 0.5rem 1.5rem;">‚Üê Back to Home</a>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>

